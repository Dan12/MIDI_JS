var BasicMIDI=new function(){this.init=function(i,e){return t.init(i,e)}
var t=new function(){var t=100,i=160,h=200,o=900,n=80
this.init=function(t,i){return new r(t,i)}
var r=function(t,i){this.player=i,$(t).append('<div class="editor_container"><canvas class="editor_canvas">Your browser does not support the HTML5 canvas tag.</canvas></div>')
var h=document.getElementsByClassName("editor_canvas")
this.canvas=h[h.length-1],this.context=this.canvas.getContext("2d"),e.init(this.canvas),this.setDimensions(),this.midiWorkspace=s.init(this.canvas,this.width,this.height,n,this)
var o=this
$(window).resize(function(){o.setDimensions()}),this.canvas.addEventListener("InputEvent",function(t){o.draw()},!1)
var r=setInterval(function(){o.isReady&&(o.draw(),clearInterval(r))},300)
this.player.linkEditor(this),console.log("New Editor created")}
r.prototype.setDimensions=function(){this.width=Math.max(window.innerWidth-t,o),this.height=Math.max(window.innerHeight-i,h),$(this.canvas).css({width:this.width+"px",height:this.height+"px"}),this.context.width=this.width,this.context.height=this.height,this.canvas.width=this.width,this.canvas.height=this.height,this.midiWorkspace&&this.midiWorkspace.windowResize(this.width,this.height),this.draw()},r.prototype.draw=function(){performance.now()
this.context.clearRect(0,0,this.width,this.height),this.context.font="16px arial",this.midiWorkspace&&this.midiWorkspace.draw(this.context)
performance.now()},r.prototype.isReady=function(){return this.midiWorkspace.ready()},r.prototype.recordKeyDown=function(t){this.midiWorkspace.recordKeyDown(t)},r.prototype.recordKeyUp=function(t){this.midiWorkspace.recordKeyUp(t)},r.prototype.midiKeyDown=function(t){this.player.midiKeyDown(t)},r.prototype.midiKeyUp=function(t){this.player.midiKeyUp(t)}},i=new function(){var t=4,i=30,e=90,s=30,h=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAYAAADifkzQAAADrklEQVR42u3czUsVURjH8UubaH25oI1nZm71DwRRWUK08aatinYFvWjtyqRN0UKLwghfaF8tTOtf0BaK7sogCInWwl3XNsQmLRJf7s07r+c853wfGBBBzu+cz5yZM85LqWRBHfKDKMlWVf6vElVsHVb+alKwOBsjbcgsu3ThYnTzRt/mBqqBcFm3+X52FtC84UzLhFgLA9XTXYsk5Ax9/zt4AvfwhpgdwTx4lvRl/df7rcVTStVsPbc4cc50ZWHQoJ8/bejXAddWdROjY/bssK4vy8X3nWuqv3X18pUdK1i1BiCzstiwr1++AlASpGpvP8bsEwxZqVSOANh6nTp+wixIz/M6AYxfI0+emgMJYPLaWDNoHz8A09fgwIA+SACFL3YAzHdMww71obDGbvX1gyhxcjALhUMCKBwSQBAp3eMNoHBIAEFsqT4tLaV6xP7x8HCUVR9Ne8Q/dTtFBQWxefV210CUjpjKociQWxGTZMwSMcnf5T0+byYnQZSOmChj0StSEPeurpOdIEpHjJ2z6HAgZpxTx8U9iBm3CaIMxP+2qyMYiBlm1fV/UhAzPKSCKAuxYdu6QoGYUd7QDz6DKAOxads67xuCCKLTiKHvfzUiEIgZZQYRRBALrtmZme2ZNz7cCqIsxF3t636iDUQQQQRRPmK5XPZAFI4YesEYiMIR/2T498OjoSEQQQQRRBDTI3JOBBFEVqcgcp3If2xAFI/IXQwLEHUHAjF+7bqfCCJ39kE0DZGn3WQhhir4BmLJpudOlb8MonBEnaFAzDAvb0WBCKLuQ6nOYCBmnJV39kEEUfehVFc4EHPIyRelLEAs+tYUiHvXmdNd8TPylUWzEBNlBNEcxLdTU8kt+PKw8C8Pg2gG4vlzPenbKSJsvV5/MT46GiXd5ufmUmVL0/bGZuws1HnxT+Uw9kBagAikBYAgWgAIpEWIQFoAuLORu7fvACl1gjAb8x3Tqgq+2LfXOARY+HgCmb4e3n8QaR9HIJPX85FnkRHj57W1nQUyfk2MjUdGjdvBSuUokK3X1rv0Ro2X53mdQBq+iEkS8t30NJjSAEWGZUyA3Kv6r13fNg5hh1oTvfe5hmlN39cXPGXXIHu7a3buvK7Myl39VGrZ/k5aguncqUPX85sF4u1z9sQvBXNlZWWxUe6qUh+5hjIctFnG0A9+cCXcAqYJX25y+rCZB2geqIsLC0a8e+EsaLPt3uDg5mbySzNugSp/Ne0LMKAZWlvfbo6zhUrVbej/b3tawRq7/DAmAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAYAAADifkzQAAAE30lEQVR42u2dTWgTQRTHU6+iIgYK+5VNVQRFra0VquIXFUVQ6cmiKELBi6JoWxVRiiDFix/4WUGx6slqFbS1oIhUq94UD4IVqade9OKhF4W6JofUWHfTTXaz+96b/4OBNNnuzHu/eW9mJzMviYQAsY3UjSor5RRT0qY1loDEI8XCKqXAygyhwWNjAtf76LETdZ0ZoL9Bp4BkDDRKLcQh5AozlFcbLdO8CnjMenhfb69HqDU/Ap4QXTJvT1EOIPSCktT1/CVSMenDRePmLXI6rOrTchfdZ8D7GMqN69d5dmQAZG6T/Ibu3rkLADmBNCorF8L7GINMJ5PzANC/vH3zhhZIW7erATC4V6IhAAmAyoIEwPCk5/796MdIAGQ+a82v6NnTp4BYPueYXp5KNK0BXsg8ygEgc5AAGJ2cO3P27/homN/DAaibh3I37Th1ChA5emOUXghPL4Pdow6jCNt/ZdOGjeFsvooTYrYc2LvPgTcGsH8cXoHd1t42sQxjf8n/3LBmbeQQs6/nzZkLmEGcKS7DudUJz8zzRs1oZwnRC+bQpyEH3khwhjhZvV+Hh5X1SjEQVQ6xvnVNaVozhfOAQWazUiGebG/3pyOVQ51BH03Ee6NhfZv0osFXg6wgZuXShYvivXJS3WYbqf64lQ+jfukhtqBOFJQOs37pZyHThvXB88NrnZ0iIHrB/DzE+/myYKek0FvL1YZbN7vEeGX7iRPuOmTzs0iGKC3EuradilJRfvmcX+pqah2OEDPl539vHm07rARE7s+Xrm2mokQc7di+rYldiAVEIePlP22kMqmhNkPOlbaWFoc8REo9j5IHUPdKQBQQYvM2GH8BRKYw/2nL+IaotesAsUiY/U/6HVIQya5EEJP3796RS6gLiExDLCCWEeai+QscQBSSwBYQGcme5uZYwiogClgQAMSQ4a1avsKJsw3jfwy8eIHnREYP/a4QsWLjLRfOn+exYgOI9MY9X+3C2ql/eHPTVSQ7V+ZlBb5PJDzu+bbVbE1rAsREYmRk5Cjbb/YphbG4j9TlytXLV0gDXLd6jfcem+whTpUgct2HWnCjlCr7TpfV1LLeRKw8RLE7wKnNDKOAt3H9erbnMZSDKO2Im69TUTifCIgkICp7UphCSA1a/0R4R1rbRAL0BZF79gwVfinV8yLbMEc5QVy1YqVSSYl865i7sHHLVocyRGSUCuviGCBOhFdft0yJ/G45fW3T7CCzclJsvSqnzCxJZ0qpMh/2PEC+01J0TyaT0yhARObhgA5FKQe4ynnAQ0vm3n33rhMXxITCEood8LsYNCCmrdQPNobN1vGkrw8Aw7Y7vIM5QIAUBBEgBQCcePPbXV0AyXViB28snyytXhLPj0PD9IztCpAC7FllmjcBUoBD2Ib5GyAFRDSscwoZkgAymM10Xa8n1yiALMoDK0g1LjNGjgGktxw/doxHR09b1p38hr59/RowuUYqhFchtlAd5IaGBhm7FFTdbuGi81RxSt3r7nZUgCeu00pW0C0HgK1pTcqEGs4waxYtVnt7pZvyO7fvYJv/W9lZuK7rszgZBPBKNFCcRjrd0eFgV3oJYuclDIzaeC8HBpzJ6rZ1/SAoheSdXqX14KGCkLOfF39f6zlohCAzEomZpUAttcDi0UlFUFjZfK/cjfAHJ5oQGJBfli8AAAAASUVORK5CYII=","data:image/png;base64,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","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAYAAADifkzQAAAD70lEQVR42u3dTU8TQRjA8WriRWMaCAlUZ2d3FRMPvpCYAAZo5KCJGowv8aLBEFCPGgwI6BfwC6iH6kEPvt4AbxgTE0945gMQExIvXjwoiBUORSht+rLd3Xlm/5Psqe3OzPObZ2a33d2mUhYUT7nPD2g3X+vmO3o1RYm+1INV63bQ9ZaJtEFot4ZH8gPnzgfaRzqdbkIiBLiZ6el8HPWiEyCIJg4mxP4flHySEKShwRtgFhdf6ZlSAfk4N5eXOmMkyW+XLQFYO4pNHqatHe7vy5Y4B3U+24b3Owmj1dqsLO7U6J271q8dxX12tc5J7cvOJC/8E2PjsrOyuPFXL11O7GG4SEjOoYTHBMDq4+Nm3JsA2pGVy0Y2rD+bBbCGePmO/mtUg57lcgDWk5HKWTGiIbAEhNynHsXagKePn4AoLRE2V3yyswtAaZCecv4wjQqHBFB4bAGMDnF9xgOQbCxaB1tbuws7Ptx+CESJkGRhfJBr0+oqgGQjiOIhAbQI8cPsbCyXzEvbjIOMsnEgli9LS0tDgRHDnipsmvaMmlajWAtBDLmOwge+zs+DaBhiVfVEdUQKIoiJQ9xio/T3sm9qbm5WUTcIxAZnY5Qn9yCGVFfhDSeOd4BoOGLJ+jKZzG6jRhSItSNG/T0piCHUB6JIxB1mjiYQ659SQRSOGMfvhiA2uE4QLUI81dsHonRE2ztuI+JGvSCCCGLciJ7yXoAoHHH9nnEQZfZlo964ri0FEUQQQQQRRBBBBBFEEK1E5DzRAkRX6ZcgCv/GJu5GgAgiiCBaiMgv+/IQfa3fl1YFUQxi+dQEUR6iamvrBFFOX7h4OAmI3IshB7EplUqDKBxx2wstLS17QTS/LxWTrfDig8lJ7hSWjsg9++Yjln2D1noARHP7UnWS8Rwb8xEr/r8UiGb2pWYXEC1C5CmLKdGDfg+I5vSl7qTiycNmPHk40CDZH/LD+kCMKJl4Gn+85eHUVGPiX9hJx5GjQMa01jYMkWwUCgikRYiuUu8KOxy8dh1IaYBkoyWAQEZTzp4+E/55ZzqVbgJScBaWO0kn9EJnuc0Vvnn1GkipyxTZ2Pg4usq9kpwRZCFgKH/JDmR0cat4uQWQZgMaFbPNjcr29IIpJQM5/Qi0Bq4yVQgqPV3dW2LiOM4wcz7rXzTF1TqXdExr+p9EyOI+G3kAE7RTtmK2e779/bQZ08rsK1d8rX/YgvltcfFtUmaZqrNSSgAktz3SgJgYFPAqTbOO/mka6MLCQl7SIBOTnWEG8OLAhSou19dfEAoBtHi7PXIzPzF+fxv02Oi9+u6zUM4KEo0Cdb1l6Xc4UUoUpdSxIFi+dn9Jj8E/T3UVUFUBWIsAAAAASUVORK5CYII="]
this.init=function(t,i,e,s){return new o(t,i,e,s)}
var o=function(t,s,o,l){console.log("New Header Created"),this.viewWidth=s,this.height=o,this.items=[],this.items.push(new r(i,10,"Play",h[1],l)),this.items.push(new r(i+e,10,"Pause",h[0],l)),this.items.push(new r(i+2*e,10,"Stop",h[3],l)),this.items.push(new r(i+3*e,10,"Record",h[2],l)),this.items.push(new r(i+4*e,10,"New",h[2],l)),this.items.push(new r(i+5*e,10,"Save",h[2],l)),this.items.push(new r(i+6*e,10,"Load",h[2],l)),this.items.push(new n(i+7*e,30,3,9,6,"Zoom",l)),this.items.push(new n(i+8*e,30,40,200,140,"BPM",l))
var a=this
t.addEventListener("InputEvent",function(t){a.generalInput(t)},!1)}
o.prototype.generalInput=function(t){for(var i in this.items)this.items[i].checkMouseOver(t.detail.mouseX,t.detail.mouseY)
if(t.detail.mouseDown)for(var i in this.items)this.items[i].checkMouseDown(t.detail)
if(t.detail.scrollConsumes>0){t.detail.scrollConsumes--
for(var i in this.items)this.items[i]instanceof n&&this.items[i].smallInc(Math.floor(t.detail.deltaX))}},o.prototype.windowResize=function(t,i){this.viewWidth=t},o.prototype.draw=function(i){i.strokeStyle="rgb(200,200,200)",i.lineWidth=t,i.strokeRect(t/2,t/2,this.viewWidth-t,this.height-t)
for(var e in this.items)this.items[e].draw(i)},o.prototype.resetButtons=function(){for(var t in this.items)this.items[t]instanceof r&&(this.items[t].isDown=!1)},o.prototype.isReady=function(){for(var t in this.items)if(!this.items[t].isReady())return!1
return!0}
var n=function(t,i,e,s,h,o,n){this.x=t,this.y=i,this.width=60,this.height=20,this.min=e,this.max=s,this.value=h,this.text=o,this.mouseOver=!1,this.midiWorkspace=n}
n.prototype.draw=function(t){t.fillStyle="rgb(240,240,240)",t.fillRect(this.x,this.y,this.width,this.height),t.fillStyle="rgb(180,180,180)"
var i=(this.value-this.min)/(this.max-this.min)*this.width+this.x
t.beginPath(),t.moveTo(i-s/2,this.y-(s-this.height)/2),t.lineTo(i+s/2,this.y-(s-this.height)/2),t.lineTo(i,this.y+this.height+(s-this.height)/2),t.closePath(),t.fill(),this.mouseOver&&(t.fillStyle="rgb(230,230,30)",t.fillRect(this.x+this.width/2+5,this.y+this.height/2+10,t.measureText(this.text+": "+this.value).width+10,20),t.fillStyle="black",t.fillText(this.text+": "+this.value,this.x+this.width/2+10,this.y+this.height/2+26))},n.prototype.isReady=function(){return!0},n.prototype.checkMouseOver=function(t,i){t>this.x&&t<this.x+this.width&&i>this.y&&i<this.y+this.height?this.mouseOver=!0:this.mouseOver=!1},n.prototype.checkMouseDown=function(t){this.mouseOver&&this.setValue(Math.round(l(t.mouseX,this.x,this.x+this.width,this.min,this.max)))},n.prototype.smallInc=function(t){this.mouseOver&&this.setValue(Math.max(Math.min(this.value+t,this.max),this.min))},n.prototype.setValue=function(t){this.value=t,this.midiWorkspace.sliderChange(this.text,this.value)}
var r=function(t,i,e,s,h){this.x=t,this.y=i,this.text=e,this.midiWorkspace=h,this.width=60,this.height=60,this.icon=new Image(this.width,this.height),this.ready=!1,this.mouseOver=!1
var o=this
this.icon.addEventListener("load",function(){o.ready=!0},!1),this.icon.src=s,this.isDown=!1}
r.prototype.isReady=function(){return this.ready},r.prototype.draw=function(t){this.isDown?t.fillStyle="rgb(100,140,200)":t.fillStyle="rgb(230,230,230)",t.beginPath(),t.ellipse(this.x+this.width/2,this.y+this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),t.fill(),t.drawImage(this.icon,this.x,this.y,this.width,this.height),this.mouseOver&&(t.fillStyle="rgb(230,230,30)",t.fillRect(this.x+this.width/2+5,this.y+this.height/2+10,t.measureText(this.text).width+10,20),t.fillStyle="black",t.fillText(this.text,this.x+this.width/2+10,this.y+this.height/2+26))},r.prototype.checkMouseOver=function(t,i){t>this.x&&t<this.x+this.width&&i>this.y&&i<this.y+this.height?this.mouseOver=!0:this.mouseOver=!1},r.prototype.checkMouseDown=function(t){this.mouseOver&&this.midiWorkspace.buttonPress(this)},r.prototype.changeState=function(t){this.state=t}
var l=function(t,i,e,s,h){return(t-i)*(h-s)/(e-i)+s}},e=new function(){this.init=function(i){this.Inputevents=new t(i)}
var t=function(t){this.detail={},this.detail.mouseDown=!1,this.detail.mouseDrag=!1,this.detail.mouseX=-1,this.detail.mouseY=-1,this.detail.keyDown=null,this.detail.deltaX=0,this.detail.deltaY=0,this.detail.scrollConsumes=0,this.detail.doubleClickConsumes=0,this.editor=t,this.prevMouseX=-1,this.prevMouseY=-1
var i=this
this.inputEvent=new CustomEvent("InputEvent",{detail:this.detail}),$(this.editor).mousedown(function(t){return i.mouseInputDown(t),!1}),$(this.editor).mouseup(function(t){return i.mouseInputUp(t),!1}),$(this.editor).mousemove(function(t){return i.mouseInputMove(t),!1}),$(this.editor).mouseleave(function(t){return i.mouseInputLeave(t),!1}),$(this.editor).dblclick(function(t){return t.preventDefault(),i.mouseInputDoubleClick(t),!1}),$(document).keydown(function(t){return i.keyInputDown(t),!1}),$(document).keyup(function(t){return i.keyInputUp(t),!1}),this.editor.addEventListener("mousewheel",function(t){return t.preventDefault(),i.mouseInputWheel(t),!1}),console.log("New Input Events")}
t.prototype.keyInputDown=function(t){this.detail.keyDown=t.keyCode,this.editor.dispatchEvent(this.inputEvent)},t.prototype.keyInputUp=function(t){this.detail.keyDown=null,this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputLeave=function(t){this.detail.mouseDown=!1,this.detail.mouseX=-1,this.detail.mouseY=-1,this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputDown=function(t){this.detail.mouseX=t.pageX-$(this.editor).offset().left,this.detail.mouseY=t.pageY-$(this.editor).offset().top,this.detail.deltaX=0,this.detail.deltaY=0,this.detail.mouseDown=!0,this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputUp=function(t){this.detail.mouseX=t.pageX-$(this.editor).offset().left,this.detail.mouseY=t.pageY-$(this.editor).offset().top,this.detail.mouseDown=!1,this.prevMouseX=-1,this.prevMouseY=-1,this.detail.mouseDrag=!1,this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputMove=function(t){this.detail.mouseX=t.pageX-$(this.editor).offset().left,this.detail.mouseY=t.pageY-$(this.editor).offset().top,-1!=this.prevMouseX&&(this.detail.deltaX=this.detail.mouseX-this.prevMouseX,this.detail.deltaY=this.detail.mouseY-this.prevMouseY),this.prevMouseX=this.detail.mouseX,this.prevMouseY=this.detail.mouseY,this.detail.mouseDown&&(this.detail.mouseDrag=!0),this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputWheel=function(t){this.detail.deltaX=t.deltaX,this.detail.deltaY=t.deltaY,this.detail.scrollConsumes=2,this.editor.dispatchEvent(this.inputEvent)},t.prototype.mouseInputDoubleClick=function(t){this.detail.doubleClickConsumes=1,this.editor.dispatchEvent(this.inputEvent)}},s=new function(){var t=4,e=30,s=24,h=10,o=16,r=70,l=[1/32,1/16,1/8,.25,.5,1,2,4,8,16,32],a=24,d=26,c=["1","2","3","4","5","6","7","8","9","0","-","=","Q","W","E","R","T","Y","U","I","O","P","[","]","A","S","D","F","G","H","J","K","L",";","'","\\n","Z","X","C","V","B","N","M",",",".","/","\\s","","<",">","^","v"],f=[49,50,51,52,53,54,55,56,57,48,189,187,81,87,69,82,84,89,85,73,79,80,219,221,65,83,68,70,71,72,74,75,76,186,222,13,90,88,67,86,66,78,77,188,190,191,16,-1,37,39,38,40]
this.init=function(t,i,e,s,h){return new u(t,i,e,s,h)}
var u=function(t,h,o,a,c){this.width=h,this.height=o-a,this.heightOffset=a,this.drawClass=c,this.BPM=140,this.ZoomLevel=0,this.BeatsPerSection=l[this.ZoomLevel+5],this.BeatsToPixels=r/this.BeatsPerSection,this.horizontalOffset=0,this.verticalOffset=0,this.scrubBarAt=0,this.edgeScroll=!1,this.scrollInterval=null,this.maxWidth=this.width,this.noteHandler=n.init(t,s,this.heightOffset+e,this.width-s,this.height-e-d,r,f.length,this)
var u=this
t.addEventListener("InputEvent",function(t){u.generalInput(t)},!1),this.isRecording=!1,this.isPlaying=!1,this.header=i.init(t,this.width,this.horizontalOffset,this),console.log("New MIDI Workspace created")}
u.prototype.generalInput=function(t){t.detail.scrollConsumes>0&&t.detail.mouseY>this.heightOffset&&(this.canvasScroll(t.detail.deltaX,t.detail.deltaY),t.detail.scrollConsumes--),t.detail.mouseDown?(t.detail.mouseY>this.heightOffset&&t.detail.mouseY<this.heightOffset+e&&(this.scrubBarAt=Math.max(0,(t.detail.mouseX-this.horizontalOffset-s)/this.BeatsToPixels)),t.detail.mouseY>this.height+this.heightOffset-d&&t.detail.mouseX>s&&this.canvasScroll(t.detail.deltaX*(this.maxWidth/this.BeatsPerSection)/this.width,0),this.checkEdgeScroll(t.detail.mouseX,t.detail.mouseY,t.detail.deltaX,t.detail.deltaY)):(null!=this.scrollInterval&&clearInterval(this.scrollInterval),this.edgeScroll=!1)},u.prototype.checkEdgeScroll=function(t,i,h,o){if(2*s>t&&0>h||t>this.width-s&&h>0||i<this.height+this.heightOffset-d&&i>this.height+this.heightOffset-d-s&&o>0||i>this.heightOffset+e&&i<this.heightOffset+e+s&&0>o){if(!this.edgeScroll){this.edgeScroll=!0
var n=this,r=[2]
2*s>t?r=[-a,0]:t>this.width-s?r=[a,0]:i<this.height+this.heightOffset-d&&i>this.height+this.heightOffset-d-s?r=[0,a]:i>this.heightOffset+e&&i<this.heightOffset+e+s&&(r=[0,-a]),this.scrollInterval=setInterval(function(){n.canvasScroll(r[0],r[1]),n.drawClass.draw()},100)}}else null!=this.scrollInterval&&clearInterval(this.scrollInterval),this.edgeScroll=!1},u.prototype.canvasScroll=function(i,h){this.horizontalOffset-=i,this.verticalOffset-=h,this.verticalOffset=Math.max(this.verticalOffset,-c.length*s+this.height-e-t-d),this.verticalOffset=Math.min(this.verticalOffset,0),this.horizontalOffset=Math.min(this.horizontalOffset,0),this.horizontalOffset=Math.max(this.horizontalOffset,Math.min(-(this.maxWidth/this.BeatsPerSection)+this.width,0)),this.noteHandler.scroll(this.horizontalOffset,this.verticalOffset)},u.prototype.windowResize=function(t,i){this.width=t,this.height=i-this.heightOffset,this.canvasScroll(0,0),this.noteHandler.windowResize(this.width-s,this.height-e-d),this.header.windowResize()},u.prototype.draw=function(i){var n=Math.ceil(this.width/r)+1
i.strokeStyle="rgb(90,70,70)",i.lineWidth=1
for(var l=0;n>l;l++)i.beginPath(),i.moveTo(l*r+s+this.horizontalOffset%r,this.heightOffset),i.lineTo(l*r+s+this.horizontalOffset%r,this.height+this.heightOffset),i.stroke()
this.noteHandler.draw(i)
var a=this.scrubBarAt*this.BeatsToPixels+this.horizontalOffset+s
i.strokeStyle="rgb(0,0,220)",i.beginPath(),i.moveTo(a,this.heightOffset+e),i.lineTo(a,this.heightOffset+this.height),i.stroke(),i.fillStyle="rgb(240,240,240)",i.fillRect(0,this.heightOffset,s,this.height),i.fillStyle="black"
for(var l=1;l<=c.length;l++){var f=this.heightOffset+e+l*s-6+this.verticalOffset
f>this.heightOffset+e&&f<=this.height+this.heightOffset+s&&i.fillText(c[l-1],8,this.heightOffset+e+l*s-6+this.verticalOffset)}var u=Math.ceil(this.height/s)
i.strokeStyle="rgb(90,70,70)"
for(var l=1;u>=l;l++)i.beginPath(),i.moveTo(0,this.heightOffset+e+l*s+this.verticalOffset%s),i.lineTo(this.width,this.heightOffset+e+l*s+this.verticalOffset%s),i.stroke()
i.fillStyle="rgb(210,210,210)",i.fillRect(0,this.heightOffset,this.width,e),i.fillStyle="black"
for(var l=0;n>l;l++){var p=l*r+s+this.horizontalOffset%r
i.beginPath(),i.moveTo(p,this.heightOffset),i.lineTo(p,this.heightOffset+e),i.stroke()
for(var g=1;3>=g;g++)i.beginPath(),i.moveTo(p+g*r/4,this.heightOffset+e-4+4*(g%2-1)),i.lineTo(p+g*r/4,this.heightOffset+e),i.stroke()
var v=l*this.BeatsPerSection+Math.floor(-1*this.horizontalOffset/r)*this.BeatsPerSection
v==Math.round(v)&&i.fillText(v+"",p+2,this.heightOffset+e-o+t)}i.fillStyle="rgb(0,0,220)",i.strokeStyle="rgb(0,0,220)",i.beginPath(),i.moveTo(a-.6*h,this.heightOffset+o+t),i.lineTo(a+.6*h,this.heightOffset+o+t),i.lineTo(a,this.heightOffset+t+h+o),i.closePath(),i.fill(),i.beginPath(),i.moveTo(a,this.heightOffset+o+t),i.lineTo(a,this.heightOffset+e),i.stroke(),i.fillStyle="rgb(100,100,100)",i.fillRect(s,this.height+this.heightOffset-d,this.width-s,d),i.fillStyle="rgb(200,200,200)",i.fillRect(s+2+this.width/(this.maxWidth/this.BeatsPerSection)*-this.horizontalOffset,this.height+this.heightOffset-d+2,this.width*this.width/(this.maxWidth/this.BeatsPerSection)-s-4-t,d-4-t),i.lineWidth=t,i.strokeStyle="rgb(170,170,170)",i.strokeRect(t/2,this.heightOffset+t/2,this.width-t,this.height-t),this.header.draw(i)},u.prototype.setMaxWidth=function(t){this.maxWidth=t+this.width},u.prototype.buttonPress=function(t){"Record"==t.text?this.isPlaying||(this.isRecording=!this.isRecording,this.header.resetButtons(),t.isDown=this.isRecording,this.isRecording?this.noteHandler.startRecording(this.BPM,this.scrubBarAt):this.scrubBarAt=this.noteHandler.stopRecording()):"Play"==t.text?this.isRecording||this.isPlaying||(this.isPlaying=!0,this.header.resetButtons(),this.noteHandler.startPlaying(this.BPM,this.scrubBarAt),t.isDown=!0):"Pause"==t.text?this.isPlaying&&(this.isPlaying=!1,this.header.resetButtons(),this.noteHandler.stopPlaying(),t.isDown=!0):"Stop"==t.text&&(this.isRecording?this.scrubBarAt=this.noteHandler.stopRecording():this.scrubBarAt=0,this.isPlaying&&this.noteHandler.stopPlaying(),this.isPlaying=!1,this.isRecording=!1,this.noteHandler.beatAt=this.scrubBarAt,this.header.resetButtons(),t.isDown=!0)},u.prototype.sliderChange=function(t,i){"Zoom"==t?(this.ZoomLevel=i-6,this.BeatsPerSection=l[this.ZoomLevel+5],this.BeatsToPixels=r/this.BeatsPerSection,this.noteHandler.changeResolution(this.BeatsPerSection),this.canvasScroll(0,0)):"BPM"==t&&(this.BPM=i)},u.prototype.redrawAll=function(){(this.isPlaying||this.isRecording)&&(this.scrubBarAt=this.noteHandler.beatAt),this.drawClass.draw()},u.prototype.isReady=function(){return this.header.ready()},u.prototype.recordKeyDown=function(t){if(this.isRecording){var i=f.indexOf(t);-1!=i&&this.noteHandler.recordNoteDown(i)}},u.prototype.recordKeyUp=function(t){if(this.isRecording){var i=f.indexOf(t);-1!=i&&this.noteHandler.recordNoteUp(i)}},u.prototype.playKeyDown=function(t){this.drawClass.midiKeyDown(f[t])},u.prototype.playKeyUp=function(t){this.drawClass.midiKeyUp(f[t])}},h=new function(){this.init=function(){return new t}
var t=function(){this.isActive=!1,this.x=0,this.y=0,this.sx=0,this.sy=0,this.w=0,this.h=0}
t.prototype.startNew=function(t,i,e,s){this.isActive=!0,this.sx=t-e,this.sy=i-s,this.x=this.sx,this.y=this.sy,this.w=0,this.h=0},t.prototype.update=function(t,i,e,s){t-e>this.sx?(this.x=this.sx,this.w=t-(this.x+e)):(this.x=t-e,this.w=this.sx-this.x),i-s>this.sy?(this.y=this.sy,this.h=i-(this.y+s)):(this.y=i-s,this.h=this.sy-this.y)},t.prototype.noteInMulti=function(t){return t.px+t.pw>this.x&&t.px<this.x+this.w&&t.py+t.height>this.y&&t.py<this.y+this.h},t.prototype.draw=function(t,i,e,s){if(this.isActive){t.globalAlpha=.3,t.fillStyle="rgb(50,50,240)"
var h=this.y+e,o=this.h
s>h&&(o-=s-h,h=s),t.fillRect(this.x+i,h,this.w,o),t.globalAlpha=1}}},o=new function(){this.createNote=function(i,e,s,h,o,n,r){return new t(i,e,s,h,o,n,r)}
var t=function(t,i,e,s,h,o,n){this.note=t,this.beat=i,this.length=e,this.height=s,this.px=h*this.beat+o,this.py=s*this.note+n,this.deltaX=0,this.deltaY=0,this.deltaWidth=0,this.pw=h*this.length,this.selected=!1,this.minResizePadding=15,this.radius=6}
t.prototype.draw=function(t,i,e){this.selected?t.fillStyle="rgb(100,140,200)":t.fillStyle="rgb(168,214,238)",t.stokeStyle="rgb(190,235,255)"
var s=this.px+i,h=this.py+e
t.beginPath(),t.moveTo(s+this.radius,h),t.lineTo(s+this.pw-this.radius,h),t.quadraticCurveTo(s+this.pw,h,s+this.pw,h+this.radius),t.lineTo(s+this.pw,h+this.height-this.radius),t.quadraticCurveTo(s+this.pw,h+this.height,s+this.pw-this.radius,h+this.height),t.lineTo(s+this.radius,h+this.height),t.quadraticCurveTo(s,h+this.height,s,h+this.height-this.radius),t.lineTo(s,h+this.radius),t.quadraticCurveTo(s,h,s+this.radius,h),t.closePath(),t.stroke(),t.fill()},t.prototype.mouseOver=function(t,i){return t>this.px&&t<this.px+this.pw&&i>this.py&&i<this.py+this.height?!0:!1},t.prototype.adjustLength=function(t,i){this.pw=t*this.length,this.px=this.beat*t+i},t.prototype.moveNote=function(t,i){this.deltaX+=t,this.deltaY+=i,this.px+=t,this.py+=i},t.prototype.rightResize=function(t){this.pw+t>1&&(this.deltaWidth+=t,this.pw+=t)},t.prototype.leftResize=function(t){this.pw-t>1&&(this.deltaX+=t,this.px+=t,this.deltaWidth-=t,this.pw-=t)},t.prototype.overLeftEdge=function(t,i){return this.pw>this.minResizePadding&&t>this.px&&t<this.px+this.pw/3&&i>this.py&&i<this.py+this.height?!0:!1},t.prototype.overRightEdge=function(t,i){return this.pw>this.minResizePadding&&t>this.px+this.pw-this.pw/3&&t<this.px+this.pw&&i>this.py&&i<this.py+this.height?!0:!1},t.prototype.mouseUp=function(t,i,e,s,h){var o=Math.round(4*this.deltaX/e)/4,n=Math.round(this.deltaY/i)
this.px+=o*e-this.deltaX,this.py+=n*i-this.deltaY,this.deltaX=0,this.deltaY=0,this.beat+=o*t,this.note+=n,this.beat<0&&(this.px+=-this.beat*e,this.beat=0),this.note<0&&(this.py+=-this.note*i,this.note=0),this.note>=h&&(this.py+=(h-1-this.note)*i,this.note=h-1)
var r=Math.round(4*this.deltaWidth/e)/4
this.pw+=r*e-this.deltaWidth,this.deltaWidth=0,this.length+=r*t,this.length<=0&&(this.length=t/4,this.pw=s*this.length)},t.prototype.isVisible=function(t,i,e,s,h,o){return this.px+this.pw+h>t&&this.px+h<t+e&&this.py+this.height+o>i&&this.py+o<i+s?!0:!1}},n=new function(){this.init=function(i,e,s,h,o,n,r,l){return new t(i,e,s,h,o,n,r,l)}
var t=function(i,e,s,o,n,l,a,d){this.x=e,this.y=s,this.width=o,this.height=n,this.PixelsPerSection=l,this.maxKeys=a,this.midiEditor=d,this.notes=[],this.visibleNotes=[],this.beatAt=0,this.resolution=1,this.PixelsPerNote=e,this.PixelsPerBeat=this.PixelsPerSection/this.resolution,this.verticalOffset=0,this.horizontalOffset=0,this.selected=[],this.multiSelect=h.init(),this.selectedMouseUp=!0,this.possibleNewNote=null,this.resizing=-1,this.farthestNote=0,this.selectedSet=!1,r.init(t),this.editor=i
var c=this
this.editor.addEventListener("InputEvent",function(t){c.generalInput(t)},!1),this.recordInterval=null,this.recordStartTime=0,this.recordBeatStart=0,this.recordNoteStart=[],this.MSToBeats=0,this.recordResolution=8,this.playInterval=null,this.playResolution=10,this.notesPlaying=[],console.log("New Note Handler created")}
t.prototype.scroll=function(t,i){var e=this.horizontalOffset-t,s=this.verticalOffset-i
if(this.horizontalOffset=t,this.verticalOffset=i,!this.multiSelect.isActive&&!this.selectedMouseUp)for(var h in this.selected)this.selected[h].moveNote(e,s)
this.visibleNotes=[]
for(var h in this.notes)this.notes[h].isVisible(this.x,this.y,this.width,this.height,this.horizontalOffset,this.verticalOffset)&&this.visibleNotes.push(this.notes[h])},t.prototype.draw=function(t){for(var i in this.visibleNotes)this.visibleNotes[i].draw(t,this.horizontalOffset,this.verticalOffset)
this.multiSelect.draw(t,this.horizontalOffset,this.verticalOffset,this.y)},t.prototype.windowResize=function(t,i){this.width=t,this.height=i},t.prototype.changeResolution=function(t){this.resolution=t,this.PixelsPerBeat=this.PixelsPerSection/this.resolution
for(var i in this.notes)this.notes[i].adjustLength(this.PixelsPerBeat,this.x)},t.prototype.findNote=function(t,i,e){for(var s,h,o=0,n=t.length-1;n>=o;)if(s=(o+n)/2|0,h=t[s],h.beat<i.beat)o=s+1
else if(h.beat>i.beat)n=s-1
else{if(e)return s
for(var r=o;n>=r;r++)if(t[r]==i)return r
o++}return e||(console.log("Didn't find note"),console.log(t),console.log(i),console.log(s+","+o+","+n),alert("Critical Error! Didn't find note")),o},t.prototype.startRecording=function(t,i){this.MSToBeats=t/6e4,this.recordStartTime=(new Date).getTime(),this.recordBeatStart=i
var e=this
this.recordInterval=setInterval(function(){e.beatAt=e.recordBeatStart+e.MSToBeats*((new Date).getTime()-e.recordStartTime),e.midiEditor.redrawAll()},100)},t.prototype.stopRecording=function(){return clearInterval(this.recordInterval),this.beatAt=this.recordBeatStart,this.recordNoteStart=[],this.beatAt},t.prototype.recordNoteDown=function(t){var i=!1
for(var e in this.recordNoteStart)this.recordNoteStart[e].note==t&&(i=!0)
i||this.recordNoteStart.push({note:t,sTime:(new Date).getTime()})},t.prototype.recordNoteUp=function(t){for(var i=(new Date).getTime(),e=0;e<this.recordNoteStart.length;e++)if(this.recordNoteStart[e].note==t){this.addNewNote(o.createNote(t,Math.round((this.recordBeatStart+(this.recordNoteStart[e].sTime-this.recordStartTime)*this.MSToBeats)*this.recordResolution)/this.recordResolution,Math.max(Math.round((i-this.recordNoteStart[e].sTime)*this.MSToBeats*this.recordResolution)/this.recordResolution,1/this.recordResolution),this.PixelsPerNote,this.PixelsPerBeat,this.x,this.y)),this.recordNoteStart.splice(e,1),e--
break}},t.prototype.startPlaying=function(t,i){this.MSToBeats=t/6e4
var e=this,s=0,h=(new Date).getTime(),o=(new Date).getTime(),n=i,r=-1
for(var l in this.notes)if(this.notes[l].beat>=n){r=l
break}-1==r&&(r=0,n=0),this.playInterval=setInterval(function(){0==e.notesPlaying.length&&r>=e.notes.length&&clearInterval(e.playInterval)
var t=(new Date).getTime()
for(e.beatAt=n+e.MSToBeats*((new Date).getTime()-h);r<e.notes.length&&e.notes[r].beat<=e.beatAt;)e.notesPlaying.push(r),e.midiEditor.playKeyDown(e.notes[r].note),r++
for(var i=0;i<e.notesPlaying.length;i++)e.notes[e.notesPlaying[i]].beat+e.notes[e.notesPlaying[i]].length<=e.beatAt&&(e.midiEditor.playKeyUp(e.notes[e.notesPlaying[i]].note),e.notesPlaying.splice(i,1),i--)
s+=t-o,o=t,s>100&&(s-=100,e.midiEditor.redrawAll())},this.playResolution)},t.prototype.stopPlaying=function(){clearInterval(this.playInterval)
for(var t in this.notesPlaying)this.midiEditor.playKeyUp(this.notes[this.notesPlaying[t]].note)
this.notesPlaying=[]},t.prototype.addNewNote=function(t){this.notes.splice(this.findNote(this.notes,t,!0),0,t),this.visibleNotes.push(t),t.px+t.pw>this.farthestNote&&(this.farthestNote=t.px+t.pw,this.midiEditor.setMaxWidth(this.farthestNote*this.resolution))}},r=new function(){this.init=function(t){t.prototype.generalInput=function(t){if(t.detail.mouseDown){var i=!1
if(this.multiSelect.isActive){this.multiSelect.update(t.detail.mouseX,t.detail.mouseY,this.horizontalOffset,this.verticalOffset)
for(var e in this.visibleNotes)!this.visibleNotes[e].selected&&this.multiSelect.noteInMulti(this.visibleNotes[e])&&(this.selected.push(this.visibleNotes[e]),this.visibleNotes[e].selected=!0)
for(var e in this.selected)this.selected[e].selected&&!this.multiSelect.noteInMulti(this.selected[e])&&(this.selected[e].selected=!1,this.selected.splice(e,1))
i=!0}else if(0==this.selected.length){for(var e=this.visibleNotes.length-1;e>=0;e--)if(this.visibleNotes[e].mouseOver(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){this.visibleNotes[e].selected=!0,this.selected.push(this.visibleNotes[e]),this.selectedMouseUp=!1,this.resizing=0,i=!0
break}}else if(this.selectedMouseUp){for(var e in this.selected)if(this.selected[e].mouseOver(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){this.selectedMouseUp=!1
break}}else{if(-1==this.resizing)for(var e in this.selected){if(this.selected[e].overLeftEdge(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){this.resizing=1
break}if(this.selected[e].overRightEdge(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){this.resizing=2
break}}-1==this.resizing&&(this.resizing=0)
for(var e in this.selected)1==this.resizing?this.selected[e].leftResize(t.detail.deltaX):2==this.resizing?this.selected[e].rightResize(t.detail.deltaX):this.selected[e].moveNote(t.detail.deltaX,t.detail.deltaY)
this.selectedSet=!1,i=!0}if(!i&&this.selectedMouseUp&&0!=this.selected.length){for(var e in this.selected)this.selected[e].selected=!1
this.selected=[],i=!0}!i&&this.selectedMouseUp&&t.detail.mouseX>this.x&&t.detail.mouseX<this.x+this.width&&t.detail.mouseY>this.y&&t.detail.mouseY<this.y+this.height&&(this.possibleNewNote=o.createNote(Math.floor((t.detail.mouseY-this.y-this.verticalOffset)/this.PixelsPerNote),Math.floor((t.detail.mouseX-this.x-this.horizontalOffset)/this.PixelsPerSection)*this.resolution,this.resolution,this.PixelsPerNote,this.PixelsPerBeat,this.x,this.y))}else if(null!=this.possibleNewNote&&(this.addNewNote(this.possibleNewNote),this.possibleNewNote=null),this.selectedMouseUp=!0,this.multiSelect.isActive=!1,this.resizing=-1,this.selected.length>0){for(var s=!1,h=this.selected.length-1;h>=0;h--)if(this.selected[h].mouseOver(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){(this.selected[h].overLeftEdge(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)||this.selected[h].overRightEdge(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset))&&($(this.editor).css("cursor","col-resize"),s=!0)
break}s||$(this.editor).css("cursor","default")}if(27==t.detail.keyDown){for(var e in this.selected)this.selected[e].selected=!1
this.selected=[]}else if(8==t.detail.keyDown){for(var e in this.selected){this.notes.splice(this.notes.indexOf(this.selected[e]),1)
var n=this.visibleNotes.indexOf(this.selected[e]);-1!=n&&this.visibleNotes.splice(n,1)}this.selected=[]}if(t.detail.mouseDrag&&(this.possibleNewNote=null,0==this.selected.length&&!this.multiSelect.isActive&&t.detail.mouseY>this.y&&this.multiSelect.startNew(t.detail.mouseX,t.detail.mouseY,this.horizontalOffset,this.verticalOffset)),(!t.detail.mouseDown||t.detail.mouseX<this.x||t.detail.mouseY<this.y||t.detail.mouseY>this.y+this.height)&&!this.selectedSet){for(var e in this.selected)this.notes.splice(this.findNote(this.notes,this.selected[e],!1),1)
for(var e in this.selected)this.selected[e].mouseUp(this.resolution,this.PixelsPerNote,this.PixelsPerSection,this.PixelsPerBeat,this.maxKeys),this.notes.splice(this.findNote(this.notes,this.selected[e],!0),0,this.selected[e])
this.selectedSet=!0}if(t.detail.doubleClickConsumes>0){for(var e=this.visibleNotes.length-1;e>=0;e--)if(this.visibleNotes[e].mouseOver(t.detail.mouseX-this.horizontalOffset,t.detail.mouseY-this.verticalOffset)){this.notes.splice(this.notes.indexOf(this.visibleNotes[e]),1),this.visibleNotes.splice(e,1),this.selected.splice(this.selected.indexOf(this.visibleNotes[e]),1)
break}t.detail.doubleClickConsumes--}},console.log("Added input function to Note Handler object")}}}
